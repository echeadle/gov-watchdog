# Bill Search Feature - API Research Summary

## Quick Reference

### What We Learned

1. **Summaries Endpoint** provides rich legislative content
   - 15k-65k character HTML summaries
   - Multiple versions as bill progresses (Introduced → Passed → Law)
   - Generated by Congressional Research Service
   - Perfect for full-text search and understanding bill scope

2. **Subjects Endpoint** provides topic classification
   - Flat (non-hierarchical) list of topics
   - Up to 238 subjects per bill (varies by scope)
   - Single policy area classification
   - Examples: "Abortion", "Agricultural conservation", "Air quality"

---

## Implementation Strategy for Bill Search

### User Search Scenarios

**Scenario 1: "Show me bills about climate change"**
- Query legislative_subjects array for "climate change"
- Return all bills with matching subject
- Use policy_area for filtering (e.g., "Environment")

**Scenario 2: "Find bills that affect agriculture"**
- Search legislative_subjects for "Agricult*"
- Matches: Agricultural insurance, agricultural prices, agricultural conservation
- Could also full-text search summaries

**Scenario 3: "What are all the defense bills?"**
- Filter by policy_area = "Defense"
- Can further filter by specific subjects (e.g., "Military readiness")

**Scenario 4: "Search bill content for specific text"**
- Full-text search on summary_text_plain field
- Handles complex queries like "Department of Agriculture funding"
- Works across all 15k-65k characters of content

---

## Data Storage & Indexing

### MongoDB Collections Structure

**bills_extended**
```
{
  bill_id: String (unique)
  congress: Int
  type: String
  number: Int
  title: String
  policy_area: String
  legislative_subjects: [String]  <- Array for filtering
  summaries: [
    {
      version_code: String
      action_date: Date
      action_desc: String
      text_html: String (full HTML)
    }
  ]
  summary_text_plain: String  <- Plain text for search
}
```

### Recommended Indexes

```javascript
// Full-text search (summaries + title)
db.bills.createIndex({ 
  "summary_text_plain": "text", 
  "title": "text",
  "policy_area": 1 
})

// Subject filtering
db.bills.createIndex({ "legislative_subjects": 1 })

// Bill lookup
db.bills.createIndex({ "congress": 1, "type": 1, "number": 1 }, { unique: true })

// Policy area browsing
db.bills.createIndex({ "policy_area": 1, "congress": 1 })
```

---

## API Fetching Strategy

### Single Bill Fetch Workflow
```
GET /bill/119/hr/1 
  → Get basic bill info

GET /bill/119/hr/1/summaries
  → Get all versions of summary content

GET /bill/119/hr/1/subjects
  → Get policy area + legislative subjects

→ COMBINE into single document → STORE in MongoDB
```

### Caching TTLs
- Summaries: 1 hour (updated frequently during session)
- Subjects: 24 hours (rarely change)
- Combined document: 1 hour (re-fetch to get latest actions)

### Rate Limit Management
- 5,000 requests/hour available
- Batch operations during off-peak hours
- Cache aggressively to reduce API calls

---

## Frontend Search Implementation

### Simple Subject Filter UI
```typescript
// Component shows list of subjects for filtering
const availableSubjects = [
  "Abortion",
  "Accounting and auditing",
  "Agricultural conservation and pollution",
  "Agricultural insurance",
  "Air quality",
  // ... up to 238 per bill
];

// User selects multiple subjects
const selectedSubjects = ["Agricultural conservation", "Air quality"];

// Query: Get all bills matching ANY of selected subjects
const bills = await searchBills({ 
  subjects: selectedSubjects,
  congress: 119 
});
```

### Full-Text Search UI
```typescript
// User types freeform query
const query = "climate change adaptation";

// Full-text search on summaries
const results = await searchBills({
  query: query,
  searchType: "fulltext"
});

// Returns bills with matching content + relevance score
```

### Policy Area Navigation
```typescript
// Browse bills by top-level category
const policyAreas = [
  "Defense",
  "Economics and Public Finance",
  "Environment",
  "Healthcare",
  // ... etc
];

// Get all bills in selected policy area
const defenseBills = await searchBills({
  policyArea: "Defense",
  congress: 119
});
```

---

## File References

- Full documentation: `/home/echeadle/Projects/Jan_01/gov-watchdog/.claude/scratchpad/congress-api-bill-structure.md`
- Research notes: `/home/echeadle/Projects/Jan_01/gov-watchdog/.claude/scratchpad/research-notes.md`

