# Bill Search Feature - Quick Reference Card

## Summaries Endpoint

**URL:** `GET /bill/{congress}/{type}/{number}/summaries`

**Example:** `GET /bill/119/hr/1/summaries?api_key=KEY`

**Response Fields:**
```
actionDate     → ISO 8601 date when action occurred
actionDesc     → "Introduced in House", "Passed Senate", etc.
versionCode    → Version identifier (00, 07, 49, 53, 55, etc.)
text           → HTML-formatted summary content
updateDate     → ISO 8601 timestamp of last update
```

**Key Facts:**
- 15,000 to 65,000+ characters per summary
- 5 common version codes track bill progression
- Generated by Congressional Research Service (no author field)
- HTML format (parse for plain text display)
- Expands in detail as bill progresses

**For Implementation:**
- Strip HTML tags for display
- Use text_plain for full-text search
- Store multiple versions to show bill evolution
- Cache for 1 hour (frequently updated)

---

## Subjects Endpoint

**URL:** `GET /bill/{congress}/{type}/{number}/subjects`

**Example:** `GET /bill/119/hr/1/subjects?api_key=KEY`

**Response Fields:**
```
policyArea
├─ name                    → Single top-level category
└─ updateDate              → ISO 8601 timestamp

legislativeSubjects[]      → Array of subjects
├─ name                    → Subject term (e.g., "Abortion")
└─ updateDate              → ISO 8601 timestamp
```

**Key Facts:**
- Flat structure (no hierarchy/nesting)
- 238 subjects for HR1 (varies by bill)
- Includes policy domains, geography, resources, environment
- Paginated (20 per page)
- Each subject is independent

**For Implementation:**
- Use array filter: `{legislative_subjects: "subject_name"}`
- Use policy_area for broad categorization
- Index legislative_subjects for fast queries
- Cache for 24 hours (rarely change)

---

## MongoDB Storage Pattern

```javascript
{
  // Identifiers
  bill_id: "hr1-119",
  congress: 119,
  type: "hr",
  number: 1,
  title: "...",

  // Subjects (from /subjects endpoint)
  policy_area: "Economics and Public Finance",
  legislative_subjects: ["Abortion", "Agriculture", ...],  // Array

  // Summaries (from /summaries endpoint)
  summaries: [
    {
      version_code: "00",
      action_date: ISODate("2025-01-07"),
      action_desc: "Introduced in House",
      text_html: "<p>...</p>",
      text_plain: "...",           // For full-text search
      updated_at: ISODate("...")
    },
    // ... more versions
  ],

  // Timestamps
  created_at: ISODate("..."),
  updated_at: ISODate("..."),
  ttl_expires_at: ISODate("...")   // 1-hour cache TTL
}
```

---

## Query Examples

### Search by subject
```javascript
db.bills.find({
  legislative_subjects: "Agricultural conservation and pollution"
})
```

### Full-text search in summaries
```javascript
db.bills.find({
  $text: { $search: "climate change" }
})
```

### Filter by policy area
```javascript
db.bills.find({
  policy_area: "Defense"
})
```

### Combined search
```javascript
db.bills.find({
  policy_area: "Defense",
  legislative_subjects: "Military readiness"
})
```

---

## API Efficiency

| Operation | Cost |
|-----------|------|
| /bill endpoint | 2 KB |
| /summaries endpoint | 50 KB |
| /subjects endpoint | 15 KB |
| Total per bill | ~65 KB, 3 API calls |
| Full Congress import | 6-7 hours for 10,000 bills |

---

## Useful Version Codes

| Code | Stage |
|------|-------|
| 00 | Introduced |
| 07 | Reported to Committee |
| 49 | Public Law |
| 53 | Passed House |
| 55 | Passed Senate |

---

## Search UI Patterns

### Pattern 1: Subject Filter Dropdown
User selects from legislative_subjects array
- Shows 238 possible subjects (complex bills)
- Simple filtering on array field

### Pattern 2: Full-Text Search Box
User types freeform query
- Searches summary_text_plain field
- Returns relevant bills with snippets

### Pattern 3: Policy Area Browse
User clicks from top-level categories
- Filter by policy_area field
- Then optionally add subject filter

### Pattern 4: Advanced Search
Combine policy_area + subjects + keywords
- policy_area: dropdown
- subjects: multi-select
- keywords: text input

---

## Implementation Checklist

- [ ] Parse HTML from summaries (use html2text or similar)
- [ ] Store both HTML and plain text versions
- [ ] Create full-text index on summary text
- [ ] Create array index on legislative_subjects
- [ ] Create compound index for policy_area + congress
- [ ] Set 1-hour TTL on documents
- [ ] Handle pagination in /subjects endpoint
- [ ] Strip version codes for display (show "Introduced" instead of "00")
- [ ] Show bill evolution timeline (all versions with dates)
- [ ] Add search filters to bill cards

---

## Gotchas

1. **HTML in summaries** - Must strip/parse for display
2. **Many subjects** - Up to 238 per bill, use lazy-loading if needed
3. **Version codes** - Map numeric codes to human-readable text
4. **Subject names** - Some are long/descriptive, allow partial search
5. **Policy area** - Single value per bill, use as primary grouping
6. **Rate limits** - 5,000 req/hour means ~6-7 hours to import all bills
7. **Cache expiry** - Different TTLs for summaries (1hr) vs subjects (24hr)

---

## Files for More Detail

- Full API structure: `congress-api-bill-structure.md`
- Implementation examples: `bill-api-examples.md`
- Research notes: `research-notes.md`
- Executive summary: `API-ANALYSIS-SUMMARY.txt`

